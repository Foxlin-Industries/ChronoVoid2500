# üìò ChronoVoid 2500 ‚Äì Design & Architecture Overview

## ü™ê GAME OVERVIEW
**ChronoVoid 2500** is a mobile-first multiplayer 2D space strategy game set in the year 2500. Players explore a galaxy connected by **Hyper-Tunnels (HTs)**, trade goods, conquer planets, build defenses, and engage in tactical combat. The game world is divided into **systems**, each containing **stars, planets, quantum stations, and HT links**. The core gameplay loop is **exploration, trading, combat, strategic resource management, and faction warfare**.

## üéÆ GAMEPLAY SUMMARY

### üåå Starting Conditions
- Players begin in **System 1**, the Earth-origin system.
- Start with:
  - **1 base ship** (100 cargo holds)
  - **300 Galactic Credits**
  - **Planet Purchase Contracts** (2, 3, 5, or 10 depending on realm setup)
- System 1 and its immediate neighbors are **Earth Alliance (EA) protected**:
  - Any act of aggression triggers **instant retaliation** by EA warships.

### üåê Realm Definition
Each realm defines a unique universe:
- **Name** (e.g., "Void Nexus Prime")
- **Number of systems** (e.g., 10,000)
- **HT link cap per system**: 4‚Äì8 (System 1 always has 10)
- **Planet density**: 1‚Äì5 scale (random 1-9 planets per system)
- **Quantum Station seeding chance**: 20‚Äì50% (default: 30%) for systems with ‚â•3 planets
- **Planet Purchase Contracts**: Randomly available at quantum stations across the galaxy

### ‚ú® System Contents
- Each System:
  - Contains 0‚Äì1 stars
  - Each star may have 1‚Äì9 planets based on random generation
  - Each system (except 1) has 1‚Äì8 HTs to other systems
  - May contain 0‚Äì1 Quantum Stations if criteria met
  - May be designated as **Artifact Systems** with special planets offering boosts

### ü™ê Planet Rules
- Planets:
  - Can be **claimed** using Planet Purchase Contracts or credits (10k‚Äì50k)
  - Generate **resources** at fixed rates
    - Unowned: 1% of normal production
    - Owned: Full rate
  - Can be **raided** by other players
    - Starts with 20% survival and retrieval chance
    - Improved with levels and store upgrades
  - Ownership decays if defenses fall below threshold

### üßç‚Äç‚ôÇÔ∏è Troops
- Bought for **3 credits per level 1 troop**
- Upgraded to level 10 max
- Cost formula: `credits = 3 √ó level √ó planetSize`
- Daily pay required per troop deployment time
- Combat:
  - HP = Level, Damage = Level
  - Turn order based on initiative
  - Targeting logic includes focus fire and defense priority

### üöÄ Ships
- 30 tiers: from **Escape Pod** to **Dreadnaught**
- Upgradeable:
  - **Cargo holds** (up to 5000)
  - **Weapons**, **shields**, **computers**
- Escape Pod:
  - No weapons, 1 cargo hold, minimal computer
  - **Limited to 10 lives** ‚Äî after 10 deaths, player is removed from server
- Dreadnaught:
  - Heavy weapons, 500 base cargo, elite computer

### üíª Ship Computer Functions
- Determines **sector awareness**:
  - Escape Pod: shows HTs only
  - Mid-tier: shows threats
  - Top-tier: shows profitable HTs, trade rates, ownership, defenses
- **Programmable Navigation** (Level 5+ ships):
  - Players can script trade routes and sector jumps
  - Delay factor: starts at 30s per action, reduces to 3s with higher-tier ships
  - Trade automation includes fallback logic
  - If attacked, program halts unless upgraded software is purchased

### üì¶ Trade System
6 Core Trade Goods:
- **Steel**, **Plasmon**, **Food Packs**, **Gold**, **Sealant**, **Oxygen Tanks**
- Generated by owned planets based on:
  - Planet size
  - Distance from star
  - Planet type modifiers (e.g., mining/agriculture)
- Starbases act as trading hubs with fluctuating prices based on:
  - Supply/demand in surrounding 3 sectors
  - Competitive starbase pricing
  - NPC traders help stabilize markets

### üè∞ Quantum Stations
- Automatically seeded if a system has ‚â•3 planets (30% default chance)
- Can be:
  - **Raided**
  - **Conquered**
  - **Used for trading**
  - **Required for system renaming**

### üõ°Ô∏è System Ownership + Rename Rules
To rename a star system, player must:
1. Own **all planets** in the system
2. Own the **quantum station**
3. Have deployed **active defenses**
4. Proposed name must be **unique**
5. Must not be under attack or in decay

## üßë‚Äçü§ù‚Äçüßë FACTIONS & WAR MODES

### üß≠ Faction System
- Players can **form or join factions**
- Faction features:
  - Shared resources
  - Defense pacts
  - Faction chat and info panels
  - Faction XP and scoring

### ‚öîÔ∏è Faction War Modes
1. **Conquest War**: Own ‚â•50.1% of all planets
2. **Trade War**: Accumulate 20 trillion of each resource
3. **Total War**: Eliminate all non-protected players; 20-day peace lock
4. **Artifact War**: Control all Artifact planets (7‚Äì10); computers have 50% chance to reveal routes

## üß∞ TECHNICAL ARCHITECTURE

### 1. üß© Unity Frontend (ChronoVoid.UnityClient)
- Mobile interface
- Key features:
  - Login screen (supports biometrics)
  - Galaxy map
  - Ship management
  - Planet/station UI
  - Combat UI
  - Admin panel
  - Leaderboard
  - Faction interface
  - Shop and ad banner

### 2. üåê ASP.NET Core API (ChronoVoid.API)
- RESTful API
- Hosted on Azure App Service
- Secured with JWT tokens
- Key endpoints:
  - `/auth/register`, `/auth/login`
  - `/server/create`, `/server/list`
  - `/system/rename-star`, `/system/ownership-check`
  - `/trade/market`, `/combat/attack`, `/planet/claim`
  - `/faction/create`, `/faction/join`, `/faction/info`
  - `/shop/buy`, `/shop/boosts`
  - `/admin/*`

### 3. üß± PostgreSQL Database

#### Core Schema Design

**User Management**
```sql
Users: UserId (PK), Username, Email, PasswordHash, CreatedAt, LastLogin, Role, Credits, Lives, BiometricEnabled
UserSessions: SessionId (PK), UserId (FK), JwtToken, ExpiresAt, DeviceInfo
```

**Game World Structure**
```sql
GameServers: ServerId (PK), ServerName, MaxSectors, HTLinkCap, PlanetDensity, StarbaseChance, ContractCount, CreatedAt, IsActive
Sectors: SectorId (PK), ServerId (FK), CoordinateX, CoordinateY, HasStar, CreatedAt
StarSystems: SystemId (PK), SectorId (FK), StarName, CustomName, OwnerId (FK Users), RenameDate
HyperTunnels: HTId (PK), FromSectorId (FK), ToSectorId (FK), CreatedAt
```

**Planets & Resources**
```sql
Planets: PlanetId (PK), SystemId (FK), OwnerId (FK Users), Size, DistanceFromStar, PlanetType, ProductionRate, DefenseLevel, LastRaid, CreatedAt
PlanetProduction: ProductionId (PK), PlanetId (FK), ResourceType, BaseRate, CurrentStock, LastUpdate
PlanetContracts: ContractId (PK), PlanetId (FK), Price, ExpiresAt, IsUsed
```

**Ships & Combat**
```sql
Ships: ShipId (PK), OwnerId (FK Users), ShipTier, CurrentSectorId (FK), CargoCapacity, WeaponLevel, ShieldLevel, ComputerLevel, HP, CreatedAt
ShipCargo: CargoId (PK), ShipId (FK), ResourceType, Quantity
Troops: TroopId (PK), OwnerId (FK Users), PlanetId (FK), Level, Count, DeployedAt, DailyPay
```

**Trading & Economy**
```sql
Starbases: StarbaseId (PK), SystemId (FK), OwnerId (FK Users), DefenseLevel, LastAttack
TradeGoods: GoodId (PK), StarbaseId (FK), ResourceType, BuyPrice, SellPrice, Stock, LastUpdate
TradeTransactions: TransactionId (PK), BuyerId (FK Users), SellerId (FK Users), ResourceType, Quantity, Price, Timestamp
```

**Factions & Combat Logs**
```sql
Factions: FactionId (PK), Name, LeaderId (FK Users), CreatedAt, XP, WarMode
FactionMembers: MemberId (PK), FactionId (FK), UserId (FK), JoinedAt, Role
CombatLog: LogId (PK), AttackerId (FK Users), DefenderId (FK Users), PlanetId (FK), Timestamp, Outcome, TroopsLost
OwnershipLog: LogId (PK), PlanetId (FK), PreviousOwnerId (FK), NewOwnerId (FK), Timestamp, Method
```

**Shop & Progression**
```sql
ShopItems: ItemId (PK), Name, Type, Price, Effect, Duration, IsActive
UserPurchases: PurchaseId (PK), UserId (FK), ItemId (FK), PurchasedAt, ExpiresAt
UserXP: XPId (PK), UserId (FK), Source, Amount, EarnedAt
```

#### Key Relationships & Constraints
- Users can own multiple Ships, Planets, and belong to one Faction
- Each Sector belongs to one GameServer and can contain one StarSystem
- Planets generate TradeGoods based on PlanetType and ownership
- Combat actions create CombatLog entries for audit trails
- Ownership changes tracked in OwnershipLog for decay calculations
- Foreign key constraints ensure data integrity across all relationships

#### Performance Indexes
- Composite indexes on (ServerId, SectorId) for galaxy queries
- Indexes on (OwnerId, CreatedAt) for user asset lookups  
- Spatial indexes on sector coordinates for proximity searches
- Partial indexes on active game sessions and unexpired contracts

### 4. ‚òÅÔ∏è Azure Hosting
- ASP.NET API: Azure App Service
- Database: Azure PostgreSQL Flexible Server
- Blob Storage: for user assets, logs, custom ship skins
- Notification Hub: alerts (attacks, paydays, faction updates)

### 5. üîÑ Real-Time Communication System

#### SignalR Hub Architecture
**Core Hubs:**
- `GalaxyHub`: Sector updates, ship movements, HT status changes
- `CombatHub`: Live combat resolution, troop deployment, raid notifications  
- `TradeHub`: Market price updates, trade completion alerts
- `FactionHub`: Faction chat, alliance notifications, war declarations
- `SystemHub`: Planet ownership changes, starbase status, system renames

#### Real-Time Event Types
**Galaxy Events:**
- Ship enters/exits sector ‚Üí notify all players in sector
- Planet claimed/lost ‚Üí notify system owners and faction members
- Starbase attacked ‚Üí immediate alerts to owners and allies
- HT network changes ‚Üí update affected sector displays

**Combat Events:**
- Raid initiated ‚Üí real-time defender notification
- Troop movements ‚Üí live battle progress updates
- Defense systems activated ‚Üí attacker/defender status updates
- Combat resolution ‚Üí immediate outcome broadcast

**Economic Events:**
- Market price fluctuations ‚Üí trader alerts in affected sectors
- Resource production milestones ‚Üí owner notifications
- Contract availability ‚Üí proximity-based trader alerts
- Trade route completion ‚Üí automated trading system updates

#### Connection Management
- **Connection Groups**: Players grouped by current sector, faction membership, owned assets
- **Selective Broadcasting**: Events only sent to relevant player groups to reduce bandwidth
- **Offline Queuing**: Critical events stored for offline players (max 50 events per user)
- **Reconnection Logic**: Automatic state synchronization on reconnect with missed events replay

#### Mobile Optimization
- **Connection Persistence**: Maintain WebSocket through app backgrounding where possible
- **Fallback Polling**: HTTP polling fallback for unreliable mobile connections
- **Data Compression**: JSON compression for large galaxy state updates
- **Batch Updates**: Group rapid events into batches to prevent UI flooding

### 6. üîê Authentication
- JWT token-based auth
- Biometric fallback via mobile OS
- Role: admin / player

### 7. üîÑ Offline Progression Engine
- Background thread updates planet resources
- Uses stored DB calculations
- Ships with programmable routes execute trades and jumps with delay logic
- Delay scales with ship tier (30s ‚Üí 3s)
- Attacks interrupt automation unless protected by purchased software

### 8. ‚ö° Scalability & Performance Architecture

#### Load Balancing Strategy
**Multi-Tier Load Distribution:**
- **Azure Application Gateway**: SSL termination, geo-routing to nearest region
- **App Service Load Balancer**: Round-robin distribution across API instances
- **Database Connection Pooling**: pgBouncer for PostgreSQL connection management
- **Redis Cache Cluster**: Distributed caching for session data, market prices, galaxy state

#### Horizontal Scaling Approach
**API Scaling:**
- Auto-scaling App Service plans (2-20 instances based on CPU/memory)
- Stateless API design allows seamless instance scaling
- Background job processing via Azure Functions for resource updates
- Separate scaling groups for read-heavy (galaxy queries) vs write-heavy (combat/trading) operations

**Database Scaling:**
- **Read Replicas**: 3 read-only replicas for galaxy browsing, leaderboards, faction queries  
- **Write Master**: Single write instance for transactions, combat, ownership changes
- **Partitioning Strategy**: GameServers sharded by ServerId for multi-universe support
- **Connection Limits**: Max 500 concurrent connections with queue management

#### Caching Strategy
**Multi-Level Caching:**
- **L1 - Memory Cache**: Frequently accessed static data (ship tiers, planet types) - 5min TTL
- **L2 - Redis Cache**: User sessions, market prices, sector data - 15min TTL  
- **L3 - CDN Cache**: Static assets, galaxy maps, UI resources - 24hr TTL
- **Cache Invalidation**: Event-driven invalidation on ownership changes, market updates

**Cache Keys Pattern:**
```
user:{userId}:profile
server:{serverId}:sector:{sectorId}:state  
market:{starbaseId}:prices
faction:{factionId}:members
galaxy:{serverId}:map
```

#### Performance Monitoring
**Key Metrics:**
- API response times (<200ms for 95th percentile)  
- Database query performance (<50ms average)
- SignalR connection counts and message throughput
- Cache hit ratios (>85% target)
- User session concurrency and peak load patterns

**Optimization Techniques:**
- **Database Query Optimization**: Prepared statements, query plan analysis
- **Lazy Loading**: Galaxy sectors loaded on-demand vs full universe
- **Batch Processing**: Group combat resolutions, trade calculations  
- **Async Processing**: Non-critical updates (XP, logs) processed asynchronously
- **Rate Limiting**: 100 requests/minute per user, 1000/minute per faction

#### Capacity Planning
**Target Performance:**
- Support 10,000+ concurrent users per server universe
- Handle 50+ combat actions per second across all servers  
- Process 500+ trade transactions per minute
- Maintain <3 second galaxy map load times
- Scale to 100+ game server universes

**Resource Allocation:**
- **Production**: 8-core API instances, 32GB RAM, Premium SSD storage
- **Database**: 16 vCores, 64GB RAM, 1TB SSD with automated backups
- **Redis**: 4GB cluster with persistence enabled
- **Monitoring**: Application Insights, custom dashboards, automated alerts

## üõçÔ∏è SHOP & SCORING SYSTEM

### üõí Shop Features
- Boosts:
  - Trade speed
  - Troop survival
  - Resource multipliers
  - Programmable ship software
- Cosmetic items:
  - Ship skins
  - Faction emblems
- Ad-based boosts:
  - Watch ads for temporary bonuses
- No pay-to-win: boosts offer advantages but not dominance

### üßÆ Scoring System
- XP earned through:
  - Combat victories
  - Trade volume
  - Planet claims
  - Faction achievements
  - Weekly events
- Leaderboards track:
  - Individual XP
  - Faction scores
  - War mode progress

## üöÄ FUTURE ROADMAP

- Player factions + alliances (expanded)
- Custom ship builds
- Weekly events (e.g., asteroid storms, alien invasions)
- In-app purchases (cosmetic only)
- Discord bot integration (galaxy alerts)
- AI-controlled alien species for PvE invasions
- Artifact planet mechanics